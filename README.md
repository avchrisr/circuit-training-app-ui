# circuit-training-app-ui

The Amazon Cognito Auth SDK for JavaScript simplifies adding sign-up, sign-in with user profile functionality to web apps.

Instead of implementing a UI for sign-up and sign-in, this SDK provides the UI via a hosted page. It supports sign-up, sign-in, confirmation, multifactor authentication, and sign-out.

## Cognito User Pool configuration
* App Client setting
  * Generate App Client Secret -- **NOT APPLICABLE FOR COGNITO AUTH** -- must be **UNCHECKED**
    * Note that Generate client secret must be unchecked when creating a web app; the Amazon Cognito Identity SDK for JavaScript doesnâ€™t support apps that have a client secret simply because the client secret could be easily viewed in your code
    * The Amazon Cognito Auth SDK does not support the app client secret. If you configure your user pool app client with an app client secret, the SDK will throw exceptions.
    * https://aws.amazon.com/blogs/mobile/accessing-your-user-pools-using-the-amazon-cognito-identity-sdk-for-javascript/
    * **UPDATE (2020-05-09)** - you **CAN** generate App Client Secret. It's just not going to be used. It cannot be used to verify JWT. (I tried it, and it resulted in "JsonWebTokenError: invalid algorithm" error)
  * Callback URL
    * http://localhost:9000/login/oauth2/code/cognito
    * `localhost` should only be used for local development environment
  * Signout URL
    * http://localhost:9000/logout
    * `localhost` should only be used for local development environment
  * OAuth 2.0
    * Auth Flow: Implicit Grant
    * Scopes: email, openId
* Configure Cognito Domain name
  * ex) `cr-test-spa-app .auth.us-west-2.amazoncognito.com`

### .env
* should match the specified endpoints in Cognito User Pool
```
VUE_APP_COGNITO_REDIRECT_URI=http://localhost:9000/login/oauth2/code/cognito
VUE_APP_COGNITO_REDIRECT_URI_SIGNOUT=http://localhost:9000/logout
VUE_APP_APP_URL=http://localhost:9000
```

### .env.local
```
VUE_APP_COGNITO_USERPOOL_ID=
VUE_APP_COGNITO_CLIENT_ID=

# leave out "https://" as auth-getSession() will add it for you
VUE_APP_COGNITO_APP_DOMAIN=
```

---

### OTHER NOTES
* Bootstrap CDN was added in `index.html`

* How does this SPA Implicit Grant auth flow integrate with Backend API? How are BE API endpoints protected based on user auth?
  * Option 1) FE and BE shares the same JWT_SECRET_KEY, which is used to sign and verify JWT
    * This option is **not** valid for Cognito Auth, because Cognito does NOT support JWT_SECRET_KEY
  * Option 2) BE to handle decoding and verifying JWT tokens generated by Cognito Auth
    * Refer to `my-playground-javascript` repo - `aws/cognito/verify-jwt.js` example
    * https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-verifying-a-jwt.html
    * https://aws.amazon.com/premiumsupport/knowledge-center/decode-verify-cognito-json-token/
  * Option 3) FE to always call `getUserInfoApi`, which makes an HTTPS request with JWT to Cognito to get userInfo. If successful, then proceed to make BE requests without BE checking JWT. BUT this is only protected if requests are made through FE. BE APIs are still open (i.e. not require auth), if publicly exposed..

